# 필터 시스템 가이드

> 상세필터모달(DetailedFilterModal) 구조 및 사용법

## 개요

`components/panel/DetailedFilterModal.tsx`는 매물 검색을 위한 상세 필터를 제공하는 모달 컴포넌트입니다.

## 탭 구조

### 5개 탭 구성

```
┌──────┬──────┬──────┬──────┬──────┐
│ 매물 │ 거래 │ 면적 │ 건물 │ 경매 │
└──────┴──────┴──────┴──────┴──────┘
```

| 탭 ID | 탭 이름 | 주요 필터 |
|-------|---------|-----------|
| `property` | 매물 | 매물유형, 층별구분 |
| `deal` | 거래 | 거래유형, 분양가, 임대료, 평당가격 |
| `area` | 면적 | 토지면적, 공급면적, 전용면적, 대지면적 |
| `building` | 건물 | 준공연도, 건물층수, 주구조, 주차대수, 승강기, 천정고, 전력용량, 증축가능성, 용도지역 |
| `auction` | 경매 | 감정가, 최저가, 유찰횟수, 입찰기간, 경매법원 |

---

## 탭별 상세 구조

### 1. 매물 탭 (`property`)

```
매물 분류
├── 매물유형 (propertyType)
│   └── 전체/지식산업센터/토지/공장/창고
└── 층별구분 (floorType)
    └── 지하층/1층/2~5층/6층이상/옥탑층
```

### 2. 거래 탭 (`deal`)

```
거래 방식
└── 거래유형 (dealType)
    └── 전체/분양/임대

가격
├── 분양가 (salePrice)
│   └── 프리셋: 5억↓, 5~10억, 10~20억, 20억↑
├── 임대료 (rentPrice)
│   └── 보증금(억) + 월세(만원)
└── 평당가격 (pricePerPyeong)
    └── 만원 단위
```

### 3. 면적 탭 (`area`)

```
면적
├── 토지면적 (landArea)
├── 공급면적 (supplyArea)
├── 전용면적 (exclusiveArea)
└── 대지면적 (siteArea)

* 모든 면적은 프리셋 제공: 100평↓, 100~300평, 300~500평, 500평↑
```

### 4. 건물 탭 (`building`)

```
건물 기본
├── 준공연도 (completionYear)
│   └── 전체/5년이내/10년이내/20년이내 + 연도 직접 입력
├── 건물층수 (totalFloors)
│   └── 최소~최대 층수
└── 주구조 (mainStructure)
    └── 철근콘크리트/철골조/조적조

시설
├── 주차대수 (parkingSpaces)
│   └── 최소~최대 대수
├── 승강기 (elevator)
│   ├── 승용 엘리베이터: 무관/없음/1대이상/2대이상
│   └── 화물 엘리베이터: 무관/없음/1대이상/2대이상
├── 천정고 (ceilingHeight)
│   └── 프리셋: 3m↓, 3~5m, 5~7m, 7m↑
└── 전력용량 (powerCapacity)
    └── 최소~최대 kW

개발
├── 증축 가능성 (buildingDevelopment)
│   ├── 빠른 선택: 여유많음/보통/포화
│   ├── 용적률: 최소~최대 %
│   └── 건폐율: 최소~최대 %
└── 용도지역 (zoning)
    └── 전용공업/일반공업/준공업/일반상업/준주거/계획관리
```

### 5. 경매 탭 (`auction`)

```
가격
├── 감정가 (auctionAppraisal)
│   └── 프리셋: 5억↓, 5~10억, 10~20억, 20억↑
└── 최저가 (auctionMinPrice)
    └── 프리셋: 3억↓, 3~5억, 5~10억, 10억↑

진행 정보
├── 유찰 횟수 (auctionFailedCount)
│   └── 전체/1회이하/2-3회/4회이상
├── 입찰 기간 (auctionBidPeriod)
│   └── 전체/진행중/예정/7일이내 + 기간 직접 설정
└── 경매 법원 (auctionCourt)
    └── 다중 선택 (인천/서울중앙/서울동부/서울남부/서울북부/서울서부/수원/부천)
```

---

## UI 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│ DetailedFilterModal (1000px 너비)                               │
├──────────┬────────────────────────────────────────────────────┤
│ 프리셋   │ 메인 영역                                          │
│ (18%)    │ (82%)                                              │
│          │ ┌──────────────┬────────────────────────────────┐ │
│ ⭐ 추천  │ │ 카테고리     │ 상세 설정                      │ │
│ ├ 공장   │ │ (30%)        │ (70%)                          │ │
│ ├ 물류   │ │              │                                │ │
│ ├ 신축   │ │ [탭 네비]    │ [필터 제목]                    │ │
│ └ 경매   │ │ 매물|거래... │ [필터 설명]                    │ │
│          │ │              │ [저장] [X]                     │ │
│ 💾 내필터│ │ ─ 메뉴 ─     │                                │ │
│ └ ...    │ │ └ 매물유형   │ [상세 폼 영역]                 │ │
│          │ │ └ 층별구분   │ - SegmentedControl             │ │
│          │ │              │ - NumberInput                  │ │
│          │ │              │ - Checkbox.Group               │ │
│          │ └──────────────┴────────────────────────────────┘ │
│          │ ┌────────────────────────────────────────────────┐ │
│          │ │ [적용된 필터 칩] [초기화] [N개 매물 보기]      │ │
│          │ └────────────────────────────────────────────────┘ │
└──────────┴────────────────────────────────────────────────────┘
```

---

## 특수 기능

### 1. 경매 탭 자동 레이어 활성화

경매 탭 선택 시 `auction-marker` 레이어가 자동으로 활성화됩니다.

```typescript
useEffect(() => {
    if (activeTab === 'auction' && !visibleLayers.has('auction-marker')) {
        toggleLayer('auction-marker');
    }
}, [activeTab, visibleLayers, toggleLayer]);
```

### 2. 필터 프리셋

빠른 필터 영역에서 추천 프리셋을 제공합니다:

| 프리셋 | 설명 |
|--------|------|
| 공장 | 공장 매물 필터 |
| 물류 | 창고/물류센터 필터 |
| 신축 | 최근 5년 이내 건물 |
| 경매 | 경매 매물 필터 |

### 3. 필터 저장

사용자가 자주 사용하는 필터 조합을 저장하고 불러올 수 있습니다.

---

## 상태 관리

### Zustand Store 연동

```typescript
// 필터 상태
const filter = useFilter();
const { setFilter, resetFilter } = useFilterActions();

// 필터된 결과 카운트
const { total, filtered } = useFilteredCount();

// 프리셋 관리
const { loadPreset, loadFilter, saveFilter, deleteFilter } = useFilterPresetActions();

// 레이어 토글 (경매 탭용)
const visibleLayers = useMapStore((state) => state.visibleLayers);
const toggleLayer = useMapStore((state) => state.toggleLayer);
```

---

## 변경 이력

### 2025-12-29: 필터 구조 재정비

#### 탭 구조 변경

| 변경 전 | 변경 후 | 변경 내용 |
|---------|---------|-----------|
| 기본 | 매물 | 이름 변경, 거래구분 제거 |
| 가격 | 거래 | 이름 변경, 거래유형 추가, 면적 분리 |
| (없음) | 면적 | 신규 탭 (가격 탭에서 분리) |
| 건축 + 시설 | 건물 | 두 탭 통합 |
| 경매 | 경매 | 물건종류 삭제 (매물유형과 중복) |

#### 주요 변경사항

1. **거래유형 + 가격 통합**: 거래구분(분양/임대)과 해당 가격 입력을 하나의 "거래" 탭으로 통합
2. **면적 탭 신설**: 가격 탭에 섞여 있던 면적 필터들을 별도 탭으로 분리
3. **건물 탭 통합**: 건축 탭과 시설 탭을 하나의 "건물" 탭으로 통합하여 간소화
4. **물건종류 삭제**: 경매 탭의 "물건 종류"는 매물 탭의 "매물유형"과 동일하여 삭제
5. **초기화 버튼 단일화**: 헤더와 하단에 있던 2개의 초기화 버튼을 하단 1개로 통합
6. **승강기 폼 통합**: 승용/화물 엘리베이터를 하나의 폼으로 통합

---

*최종 업데이트: 2025-12-29*
